Network Services 2
##################
:Author: David Boyd
:Date: 2020-11-17

[Task 3] Enumerating NFS
************************

enumeration
	a process which establishes an active connection to the target hosts to
	discover potential attack vectors in the system, and the same can be used
	for further exploitation of the system.

NSF-Common
	a package used in NFS interaction that include programs, such as: lock,
	statd, showmount, nfsstat, gssd, idmapd, and mount.nfs.

.. code-block:: Bash

	# Install NFS-Common pckg
	sudo apt install nfs-common -y

Mounting NFS Shares
===================

Your client's system needs a directory where all the content shared by the host
server in the export folder can be accessed.  You can create this folder
anywhere on your system.  Once you've created this mount point, you can use the
"mount" command to connect the NFS share to the mount point on your machine,
like this:

.. code-block:: Bash

	sudo mount -t nfs IP:share /tmp/mount/ -nolock

+----------+-------------------------------------------------------------+
| Tag      | Function                                                    |
+==========+=============================================================+
| mount    | execute the mount command                                   |
+----------+-------------------------------------------------------------+
| -t nfs   | type of device to mount, then specifying that it's NFS      |
+----------+-------------------------------------------------------------+
| IP:share | The IP Address of the NFS server, and the name of the share |
|          | we wish to mount                                            |
+----------+-------------------------------------------------------------+
| -noloock | Specifies not to use NLM locking                            |
+----------+-------------------------------------------------------------+

Questions
=========

Conduct a thorough port scan scan of your choosing, how many ports are open?
----------------------------------------------------------------------------
:Answer: 7

Which port contains the service we're looking to enumerate?
-----------------------------------------------------------
:Answer: 2049
:Note: 2049: UDP - NFS (Network File SYstem) (Official)

Now, use /usr/sbin/showmount -e [IP] to list the NFS shares, what is the name of the visible share?
---------------------------------------------------------------------------------------------------
:Answer: /home

Walkthrough
^^^^^^^^^^^
:showmount: show mount information for an NFS server
:showmount -e (or --exports): Show the NFS server's export list.

.. code-block:: Bash

	showmount -e $TM

What is the name of the folder inside?
--------------------------------------
:Answer: cappucino

Walkthrough
^^^^^^^^^^^
:WSL: OVPN needs to be initiated through WSL, not Windows.

Time to mount the share to our local machine!

First, use `mkdir /tmp/mount` to create a directory on your machine to mount
the share to. This is in the /tmp directory- so be aware that it will be
removed on restart.

Then, use the mount command we broke down earlier to mount the NFS share to
your local machine. Change directory to where you mounted the share-

.. code-block:: Bash

	# Mount the $TM's folder
	sudo mount -t nfs $TM:/home /tmp/mount/ -nolock
	# If using WSL
	sudo mount -t nfs $TM:/home /tmp/mount/ -o nolock

Have a look inside this directory, look at the files. Looks like we're inside a user's home directory...
--------------------------------------------------------------------------------------------------------
:Answer: [No answer needed]

Interesting! Let's do a bit of research now, have a look through the folders.  Which of these folders could contain keys that would give us remote access to the server?
------------------------------------------------------------------------------------------------------------------------------------------------------------------------
:Answer: .ssh

Which of these keys is most useful to us?
-----------------------------------------
:Answer: id_rsa

Can we log into the machine using ssh -i <key-file> <username>@<ip>? (Y/N))
---------------------------------------------------------------------------
:Answer: Y

Walkthrough
^^^^^^^^^^^

Copy this file to a different location your local machine, and change the
permissions to "600" using "chmod 600 [file]".

Assuming we were right about what type of directory this is, we can pretty
easily work out the name of the user this key corresponds to.

.. code-block:: Bash

	mkdir /tmp/bleh && cd /tmp/bleh/
	cp /tmp/mount/cappucino/.ssh/id_rsa /tmp/bleh/id_rsa
	sudo chmod 600 id_rsa
	ssh -i id_rsa cappucino@$TM

[Task 4] Exploiting NFS
***********************

Introduction
============

root_squash
	a NFS shares feature that, when enabled, prevents anyone connecting to the
	NFS share from *having root access* to the NFS volume.  Thus, remote "root"
	users are assigned as "nfsnobody" users when connected.  If root_squash is
	turned off, then remote users can create SUID bit files.

SUID bit set
	file(s) can be run with the permissions of the file(s) owner/group.  --as a
	super-user, we can leverage SUID to get a shell with


